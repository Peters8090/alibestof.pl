{% extends 'base/base.html' %}

{% load static %}
{% block add_css %}
    {% static 'products/css/product_list_style.css' %}
{% endblock %}

{% block title %}
    {{ username }}
{% endblock %}

{% block add_href_text %}{{ username }}'s profile{% endblock %}
{% block add_href %}
    {% url 'products:products_list' username %}
{% endblock %}

{% block content %}
    <article class="text-center">
        {% if products %}
            <nav class="container-md sticky-top">
                <form action="{% url 'products:products_list' username %}" method="get">
                    <div class="input-group">
                        {{ product_search_form }}
                        <button type="submit" class="btn btn-primary mb-3">&#x1F50D</button>
                    </div>
                </form>
            </nav>

            {% for product in products %}
                <div class="product">
                    <div class="card">
                        <img src="{{ product.image.url }}" alt="{{ product.name }}"/>
                        <input type="text" class="form-control" readonly="readonly" value="{{ product.name }}"/>
                        <a class="btn btn-primary" href="{% url "products:product_detail" product.pk %}"
                           role="button">More</a>
                    </div>
                </div>
            {% endfor %}

            <nav class="pt-4">
                <ul class="pagination justify-content-center">
                    {% if products_paginator_current_page.has_previous %}
                        <li class="page-item">
                            <!--@formatter:off--><a class="page-link" href="{% url 'products:products_list' username products_paginator_current_page.previous_page_number %}{{ request_text }}"><</a><!--@formatter:on-->
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <a class="page-link"
                               href=""><</a>
                        </li>
                    {% endif %}

                    {% for i in products_paginator.page_range %}

                        {% if i == 1 or i == products_paginator.count or i == products_paginator_current_page.previous_page_number or i == products_paginator_current_page.next_page_number or i == products_paginator_current_page.number %}
                            {% if i == products_paginator.count and products_paginator.count > 1 %}
                                <form action="{% url 'products:products_list_pagination_custom_page_redirect' username %}"
                                      method="get">
                                    <input type="hidden" name="request_text" value="{{ request_text }}">
                                    <input type="number" name="page" class="pagination-number-input"
                                           placeholder="..." min="1" max="{{ products_paginator.count }}"
                                           onKeyDown="if(this.value.length===2 && event.keyCode>47 && event.keyCode < 58) return false;">
                                </form>
                            {% endif %}

                            {% if i == products_paginator_current_page.number %}
                                <li class="page-item active">
                                    <a class="page-link" href="">{{ i }}</a>
                                </li>
                            {% else %}
                                <li class="page-item">
                                    <!--@formatter:off--><a class="page-link" href="{% url 'products:products_list' username i %}{{ request_text }}">{{ i }}</a><!--@formatter:on-->
                                </li>
                            {% endif %}
                        {% endif %}

                    {% endfor %}

                    {% if products_paginator_current_page.has_next %}
                        <li class="page-item">
                        <!--@formatter:off--><a class="page-link" href="{% url 'products:products_list' username products_paginator_current_page.next_page_number %}{{ request_text }}">></a><!--@formatter:on-->
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <a class="page-link" href="">></a>
                        </li>
                    {% endif %}
                </ul>
            </nav>

        {% else %}
            <div class="alert alert-danger" role="alert">
                No products found.
            </div>
        {% endif %}
    </article>
{% endblock %}